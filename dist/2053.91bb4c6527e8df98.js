"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[2053],{22053:(G,v,o)=>{o.r(v),o.d(v,{DfScriptDetailsComponent:()=>f});var Z=o(97582),D=o(78791),h=o(82599),p=o(42346),u=o(64170),d=o(98525),m=o(96814),g=o(24546);const T=[{label:(0,p.Iu)("scriptTypes.nodejs"),value:g.h.NODEJS,extension:"js"},{label:(0,p.Iu)("scriptTypes.php"),value:g.h.PHP,extension:"php"},{label:(0,p.Iu)("scriptTypes.python"),value:g.h.PYTHON,extension:"py"}];var r,c=o(56223),_=o(32296),x=o(55799),I=o(24630),S=o(2032),A=o(27921),y=o(37398),E=o(15711),O=o(86806),t=o(65879),C=o(81896),b=o(65763),N=o(23680);function J(i,n){if(1&i&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function Q(i,n){if(1&i&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function U(i,n){if(1&i&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function F(i,n){if(1&i&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function Y(i,n){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-form-field",3)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"mat-select",12),t.NdJ("valueChange",function(s){t.CHM(e);const l=t.oxw(2);return t.KtG(l.selectTable=s)})("selectionChange",function(){t.CHM(e);const s=t.oxw(2);return t.KtG(s.selectedTable())}),t.YNc(6,F,2,2,"mat-option",5),t.qZA()(),t.BQk()}if(2&i){const e=t.oxw(2);t.xp6(3),t.Oqu(t.lcZ(4,3,"scripts.tableName")),t.xp6(2),t.Q6J("value",e.selectTable),t.xp6(1),t.Q6J("ngForOf",e.tableOptions)}}function L(i,n){if(1&i&&(t.ynx(0),t.TgZ(1,"mat-form-field",17)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t._UZ(5,"input",18),t.qZA(),t.BQk()),2&i){const e=t.oxw(2);t.xp6(3),t.Oqu(t.lcZ(4,2,"scripts.scriptName")),t.xp6(2),t.Q6J("value",e.completeScriptName)}}function R(i,n){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-form-field",3)(2,"mat-label"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"mat-select",12),t.NdJ("valueChange",function(s){t.CHM(e);const l=t.oxw();return t.KtG(l.selectedServiceItem=s)})("selectionChange",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedServiceItemEvent())}),t.YNc(6,J,2,2,"mat-option",5),t.qZA()(),t.TgZ(7,"mat-form-field",13)(8,"mat-label"),t._uU(9),t.ALo(10,"transloco"),t.qZA(),t.TgZ(11,"mat-select",12),t.NdJ("valueChange",function(s){t.CHM(e);const l=t.oxw();return t.KtG(l.selectedEventItem=s)})("selectionChange",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.selectedEventItemEvent())}),t.YNc(12,Q,2,2,"mat-option",5),t.qZA()(),t.TgZ(13,"mat-form-field",13)(14,"mat-label"),t._uU(15),t.ALo(16,"transloco"),t.qZA(),t.TgZ(17,"mat-select",14),t.NdJ("valueChange",function(s){t.CHM(e);const l=t.oxw();return t.KtG(l.selectedRouteItem=s)}),t.YNc(18,U,2,2,"mat-option",5),t.qZA()(),t.YNc(19,Y,7,5,"ng-container",15),t.YNc(20,L,6,4,"ng-container",15),t.BQk()}if(2&i){const e=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,11,"service")),t.xp6(2),t.Q6J("value",e.selectedServiceItem),t.xp6(1),t.Q6J("ngForOf",e.storeServiceArray),t.xp6(3),t.Oqu(t.lcZ(10,13,"scripts.scriptType")),t.xp6(2),t.Q6J("value",e.selectedEventItem),t.xp6(1),t.Q6J("ngForOf",e.ungroupedEventItems),t.xp6(3),t.Oqu(t.lcZ(16,15,"scripts.scriptMethod")),t.xp6(2),t.Q6J("value",e.selectedRouteItem),t.xp6(1),t.Q6J("ngForOf",e.ungroupedRouteOptions),t.xp6(1),t.Q6J("ngIf",e.tableOptions),t.xp6(1),t.Q6J("ngIf",e.completeScriptName)}}function j(i,n){if(1&i&&(t.TgZ(0,"mat-form-field",17)(1,"mat-label"),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t._UZ(4,"input",19),t.qZA()),2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"scripts.tableName")),t.xp6(2),t.Q6J("value",e.completeScriptName)}}function q(i,n){if(1&i&&(t.TgZ(0,"mat-option",16),t._uU(1),t.qZA()),2&i){const e=n.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.label," ")}}o(6625);let f=((r=class{constructor(n,e,a,s,l){this.activatedRoute=n,this.fb=e,this.router=a,this.eventScriptService=s,this.themeService=l,this.types=T,this.type="create",this.loaded=!1,this.isDarkMode=this.themeService.darkMode$,this.storeServiceArray=[],this.ungroupedEventItems=[],this.scriptForm=this.fb.group({name:["",[c.kI.required]],type:["nodejs",[c.kI.required]],content:[""],storageServiceId:[],storagePath:[""],isActive:[!1],allow_event_modification:[!1]})}ngOnInit(){this.activatedRoute.data.subscribe(({data:n,type:e})=>{this.type=e,"edit"===e?(this.scriptDetails=n,this.scriptForm.patchValue(n),this.scriptForm.controls.name.disable(),this.completeScriptName=n.name):(this.scriptEvents=(0,E.p)(n),this.unGroupedEvents=n,this.storageServices=n,this.storeServiceArray=Object.keys(this.storageServices))}),this.scriptEventsOptions=this.scriptForm.controls.name.valueChanges.pipe((0,A.O)(""),(0,y.U)(n=>this.filterGroup(n))),this.loaded=!0}getControl(n){return this.scriptForm.controls[n]}goBack(){this.router.navigate(["../"],{relativeTo:this.activatedRoute})}submit(){const n=this.scriptForm.getRawValue(),e={...n,storageServiceId:"local_file"===n.storageServiceId?.type?n.storageServiceId?.id:null,storage_path:"local_file"===n.storageServiceId?.type?n.storagePath:null,name:this.completeScriptName};"edit"===this.type?(this.scriptDetails={...this.scriptDetails,...e},this.eventScriptService.update(n.name,n).subscribe(()=>this.goBack())):(this.scriptDetails=n,this.eventScriptService.create(e,void 0,e.name).subscribe(()=>this.goBack()))}filterGroup(n){return n?this.scriptEvents.map(e=>({name:e.name,endpoints:e.endpoints.filter(a=>a.toLowerCase().includes(n.toLowerCase()))})).filter(e=>e.endpoints.length>0):this.scriptEvents}selectedServiceItemEvent(){this.ungroupedEventItems=[],this.ungroupedRouteOptions=[],this.selectedRouteItem="";let n=this.selectedServiceItem;"api_docs"===n&&(n="apiDocs"),this.ungroupedEventOptions=this.unGroupedEvents[n],this.ungroupedEventItems=this.ungroupedEventItems||[],Object.keys(this.ungroupedEventOptions).forEach(e=>{this.ungroupedEventItems.push(e)})}selectedEventItemEvent(){this.tableOptions=[],this.ungroupedRouteOptions=[...this.ungroupedEventOptions[this.selectedEventItem].endpoints],this.ungroupedEventOptions[this.selectedEventItem].parameter&&(this.tableOptions=[...this.ungroupedEventOptions[this.selectedEventItem].parameter.tableName])}selectedTable(){this.completeScriptName=this.selectedRouteItem.replace("{table_name}",this.selectTable)}}).\u0275fac=function(n){return new(n||r)(t.Y36(C.gz),t.Y36(c.qu),t.Y36(C.F0),t.Y36(O.qY),t.Y36(b.F))},r.\u0275cmp=t.Xpm({type:r,selectors:[["df-script-details"]],standalone:!0,features:[t.jDz],decls:25,vars:28,consts:[[1,"details-section",3,"formGroup","ngSubmit"],[4,"ngIf","ngIfElse"],["editing",""],["appearance","outline","subscriptSizing","dynamic",1,"full-width"],["formControlName","type"],[3,"value",4,"ngFor","ngForOf"],["formControlName","isActive",1,"dynamic-width"],["formControlName","allow_event_modification",1,"dynamic-width"],[1,"full-width",3,"cache","type","storageServiceId","storagePath","content"],[1,"full-width","action-bar"],["mat-flat-button","","type","button",1,"cancel-btn",3,"click"],["mat-flat-button","","color","primary",1,"save-btn"],[3,"value","valueChange","selectionChange"],["appearance","outline","subscriptSizing","dynamic",1,"half-width"],[3,"value","valueChange"],[4,"ngIf"],[3,"value"],["appearance","outline",1,"full-width"],["matInput","",3,"value"],["matInput","","disabled","",3,"value"]],template:function(n,e){if(1&n&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return e.submit()}),t.ALo(1,"async"),t.YNc(2,R,21,17,"ng-container",1),t.YNc(3,j,5,4,"ng-template",null,2,t.W1O),t.TgZ(5,"mat-form-field",3)(6,"mat-label"),t._uU(7),t.ALo(8,"transloco"),t.qZA(),t.TgZ(9,"mat-select",4),t.YNc(10,q,2,2,"mat-option",5),t.qZA()(),t.TgZ(11,"mat-slide-toggle",6),t._uU(12),t.ALo(13,"transloco"),t.qZA(),t.TgZ(14,"mat-slide-toggle",7),t._uU(15),t.ALo(16,"transloco"),t.qZA(),t._UZ(17,"df-script-editor",8),t.TgZ(18,"div",9)(19,"button",10),t.NdJ("click",function(){return e.goBack()}),t._uU(20),t.ALo(21,"transloco"),t.qZA(),t.TgZ(22,"button",11),t._uU(23),t.ALo(24,"transloco"),t.qZA()()()),2&n){const a=t.MAs(4);t.Tol(t.lcZ(1,16,e.isDarkMode)?"dark-theme":""),t.Q6J("formGroup",e.scriptForm),t.xp6(2),t.Q6J("ngIf","edit"!==e.type)("ngIfElse",a),t.xp6(5),t.Oqu(t.lcZ(8,18,"scriptType")),t.xp6(3),t.Q6J("ngForOf",e.types),t.xp6(2),t.Oqu(t.lcZ(13,20,"active")),t.xp6(3),t.Oqu(t.lcZ(16,22,"Allow Event Modification")),t.xp6(2),t.Q6J("cache",e.scriptForm.getRawValue().name)("type",e.getControl("type"))("storageServiceId",e.getControl("storageServiceId"))("storagePath",e.getControl("storagePath"))("content",e.getControl("content")),t.xp6(3),t.hij(" ",t.lcZ(21,24,"cancel")," "),t.xp6(3),t.hij(" ",t.lcZ(24,26,"save")," ")}},dependencies:[h.rP,h.Rr,p.Ot,u.lN,u.KE,u.hX,d.LD,d.gD,N.ey,m.ax,c.u5,c._Y,c.JJ,c.JL,c.UX,c.sg,c.u,_.ot,_.lW,x.E,I.Bb,S.c,S.Nt,m.Ov,m.ez,m.O5],encapsulation:2}),r);f=(0,Z.gn)([(0,D.c)({checkProperties:!0})],f)}}]);