"use strict";(self.webpackChunkdf_admin_interface=self.webpackChunkdf_admin_interface||[]).push([[599],{62810:(U,A,i)=>{i.d(A,{E:()=>C});var _,M=i(97582),f=i(96814),c=i(56223),g=i(32296),d=i(17700),a=i(64170),p=i(2032),m=i(98525),v=i(75986),I=i(42346),D=i(86806),S=i(30977),T=i(78791),e=i(67961),y=i(41609),b=i(94664),t=i(65879),x=i(65763);function u(l,s){if(1&l&&(t.TgZ(0,"mat-form-field",11)(1,"mat-label"),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t._UZ(4,"input",12),t.qZA()),2&l){const o=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,2,"path")),t.xp6(2),t.Q6J("formControl",o.storagePath)}}function n(l,s){if(1&l&&(t.ynx(0),t.YNc(1,u,5,4,"mat-form-field",10),t.BQk()),2&l){const o=t.oxw();t.xp6(1),t.Q6J("ngIf",!o.storageServiceId||!o.storageServiceId.getRawValue())}}function r(l,s){if(1&l){const o=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(o);const E=t.oxw(2);return t.KtG(E.deleteCache())}),t._uU(1),t.ALo(2,"transloco"),t.qZA()}2&l&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"scripts.deleteCache")," "))}function h(l,s){if(1&l){const o=t.EpF();t.TgZ(0,"div",13)(1,"button",14),t.NdJ("click",function(){t.CHM(o);const E=t.oxw();return t.KtG(E.viewLatest())}),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t.YNc(4,r,3,3,"button",15),t.qZA()}if(2&l){const o=t.oxw();t.xp6(1),t.Q6J("disabled",!o.storageServiceId||!o.storageServiceId.getRawValue()),t.xp6(1),t.hij(" ",t.lcZ(3,3,"scripts.viewLatest")," "),t.xp6(2),t.Q6J("ngIf",o.cache)}}function Z(l,s){1&l&&(t.TgZ(0,"span"),t._uU(1,"Script Contents"),t.qZA())}i(6625);let C=((_=class{constructor(s,o,P,E,O){this.dialog=s,this.fileService=o,this.cacheService=P,this.baseService=E,this.themeService=O,this.storageServices=[],this.checked=!1,this.isDarkMode=this.themeService.darkMode$,this.baseService.getAll({additionalParams:[{key:"group",value:"source control,file"}]}).subscribe(L=>{this.storageServices=L.services})}ngOnInit(){this.storageServiceId.getRawValue()&&this.storagePath.addValidators([c.kI.required]),this.storageServiceId.valueChanges.subscribe(s=>{this.storagePath.reset(),s?this.storagePath.addValidators([c.kI.required]):this.storagePath.hasValidator(c.kI.required)&&this.storagePath.removeValidators([c.kI.required]),this.storagePath.updateValueAndValidity()})}fileUpload(s){const o=s.target;o.files&&(0,S.Vu)(o.files[0]).subscribe(P=>{this.content.setValue(P)})}githubImport(){this.dialog.open(e.e).afterClosed().subscribe(o=>{o&&this.content.setValue(window.atob(o.data.content))})}viewLatest(){const s=`${this.storageServices.find(o=>o.id===this.storageServiceId.getRawValue())?.name}/${this.storagePath.getRawValue()}`;s.endsWith(".json")?this.fileService.downloadJson(s).subscribe(o=>this.content.setValue(o)):this.fileService.downloadFile(s).pipe((0,b.w)(o=>(0,S.Vu)(o))).subscribe(o=>this.content.setValue(o))}deleteCache(){this.cache&&this.cacheService.delete(`_event/${this.cache}`,{snackbarSuccess:"scripts.deleteCacheSuccessMsg"}).subscribe()}}).\u0275fac=function(s){return new(s||_)(t.Y36(d.uw),t.Y36(D.PA),t.Y36(D.OP),t.Y36(D.PA),t.Y36(x.F))},_.\u0275cmp=t.Xpm({type:_,selectors:[["df-script-editor"]],inputs:{isScript:"isScript",cache:"cache",type:"type",storageServiceId:"storageServiceId",storagePath:"storagePath",content:"content"},standalone:!0,features:[t.jDz],decls:18,vars:18,consts:[[1,"details-section"],[1,"actions","full-width"],["type","file",2,"display","none",3,"accept","change"],["fileInput",""],["type","button","mat-flat-button","",1,"save-btn",3,"disabled","click"],[3,"ngModel","ngModelChange"],[4,"ngIf"],["class","actions",4,"ngIf"],[1,"content"],[1,"full-width",3,"formControl","mode"],["class","full-width","subscriptSizing","dynamic",4,"ngIf"],["subscriptSizing","dynamic",1,"full-width"],["matInput","",3,"formControl"],[1,"actions"],["mat-flat-button","","color","primary","type","button",3,"disabled","click"],["mat-flat-button","","color","primary","type","button",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","type","button",3,"click"]],template:function(s,o){if(1&s){const P=t.EpF();t.TgZ(0,"div",0),t.ALo(1,"async"),t.TgZ(2,"div",1)(3,"input",2,3),t.NdJ("change",function(O){return o.fileUpload(O)}),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){t.CHM(P);const O=t.MAs(4);return t.KtG(O.click())}),t._uU(6),t.ALo(7,"transloco"),t.qZA(),t.TgZ(8,"button",4),t.NdJ("click",function(){return o.githubImport()}),t._uU(9),t.ALo(10,"transloco"),t.qZA()(),t.TgZ(11,"mat-checkbox",5),t.NdJ("ngModelChange",function(O){return o.checked=O}),t._uU(12," Add path to file"),t.qZA(),t.YNc(13,n,2,1,"ng-container",6),t.YNc(14,h,5,5,"div",7),t.TgZ(15,"div",8),t.YNc(16,Z,2,0,"span",6),t._UZ(17,"df-ace-editor",9),t.qZA()()}2&s&&(t.Tol(t.lcZ(1,12,o.isDarkMode)?"dark-theme":""),t.xp6(5),t.Q6J("disabled",!o.storageServiceId),t.xp6(1),t.hij(" ",t.lcZ(7,14,"desktopFile")," "),t.xp6(2),t.Q6J("disabled",!o.storageServiceId),t.xp6(1),t.hij(" ",t.lcZ(10,16,"githubFile")," "),t.xp6(2),t.Q6J("ngModel",o.checked),t.xp6(2),t.Q6J("ngIf",o.checked),t.xp6(1),t.Q6J("ngIf",o.storageServiceId.getRawValue()),t.xp6(2),t.Q6J("ngIf",o.isScript),t.xp6(1),t.Q6J("formControl",o.content)("mode",o.type.getRawValue()))},dependencies:[g.ot,g.lW,I.Ot,f.O5,a.lN,a.KE,a.hX,m.LD,v.p9,v.oG,c.u5,c.Fj,c.JJ,c.On,d.Is,p.c,p.Nt,y.C,f.Ov,c.UX,c.oH],styles:[".actions[_ngcontent-%COMP%]{display:flex;gap:16px}.content[_ngcontent-%COMP%]{margin-top:8px;display:flex;flex-direction:column;gap:6px;width:100%}.content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px}"]}),_);C=(0,M.gn)([(0,T.c)({checkProperties:!0})],C)},67961:(U,A,i)=>{i.d(A,{e:()=>_});var b,M=i(97582),f=i(17700),c=i(32296),g=i(2032),d=i(64170),a=i(56223),p=i(26306),m=i(58504),v=i(96814),I=i(42346),D=i(86806),S=i(78791),e=i(65879);function t(u,n){1&u&&(e.TgZ(0,"mat-error"),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&u&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"scripts.errors.githubImport")," "))}function x(u,n){1&u&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"GitHub Username"),e.qZA(),e._UZ(3,"input",9),e.qZA())}function R(u,n){1&u&&(e.TgZ(0,"mat-form-field")(1,"mat-label"),e._uU(2,"GitHub Password"),e.qZA(),e._UZ(3,"input",10),e.qZA())}i(6625);let _=((b=class{constructor(n,r,h){this.githubService=n,this.formBuilder=r,this.dialogRef=h,this.isGitRepoPrivate=!1,this.formGroup=r.group({url:["",[a.kI.required,this.urlValidator]]})}ngOnInit(){this.formGroup.controls.url.valueChanges.subscribe(n=>{if(function T(u){let n;try{n=new URL(u)}catch{return!1}return"http:"===n.protocol||"https:"===n.protocol}(n)&&(n.indexOf(".js")>0||n.indexOf(".py")>0||n.indexOf(".php")>0||n.indexOf(".txt")>0)&&n.includes("github")){const h=n.substring(n.indexOf(".com/")+5).split("/");this.repoOwner=h[0],this.repoName=h[1],this.fileName=h[4],this.githubService.get(`${this.repoOwner}/${this.repoName}`,{snackbarError:"server",snackbarSuccess:"getScriptSuccessMsg",includeCacheControl:!1}).pipe((0,p.K)(C=>(this.isGitRepoPrivate=!0,this.formGroup.addControl("username",this.formBuilder.control("",a.kI.required)),this.formGroup.addControl("password",this.formBuilder.control("",a.kI.required)),(0,m._)(()=>new Error(C))))).subscribe(C=>{this.isGitRepoPrivate=C.private})}})}urlValidator(n){const r=n.value;return(r.indexOf(".js")>0||r.indexOf(".py")>0||r.indexOf(".php")>0||r.indexOf(".txt")>0)&&r.includes("github")?null:{invalidUrl:!0}}onFileUrlChange(n){}onUpload(){if(this.formGroup.invalid)return;const n=`${this.repoOwner}/${this.repoName}/contents/${this.fileName}`,r=window.btoa(this.formGroup.value.username+":"+this.formGroup.value.password);this.githubService.get(n,{additionalParams:[{key:"ref",value:"main"}],additionalHeaders:[...this.isGitRepoPrivate?[{key:"Authorization",value:`Basic ${r}`}]:[]]}).subscribe(Z=>{this.dialogRef.close({data:Z})})}}).\u0275fac=function(n){return new(n||b)(e.Y36(D.mx),e.Y36(a.qu),e.Y36(f.so))},b.\u0275cmp=e.Xpm({type:b,selectors:[["df-scripts-github-dialog"]],standalone:!0,features:[e.jDz],decls:18,vars:10,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"details-section",3,"formGroup"],["subscriptSizing","dynamic"],["matInput","","formControlName","url","placeholder","https://github.com/user/repo/blob/file.json"],[4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click"],["matInput","","formControlName","username","placeholder","Username","type","text"],["matInput","","formControlName","password","placeholder","Password","type","password"]],template:function(n,r){1&n&&(e.TgZ(0,"h1",0),e._uU(1,"Import a script file from GitHub"),e.qZA(),e.TgZ(2,"div",1)(3,"form",2)(4,"mat-form-field",3)(5,"mat-label"),e._uU(6,"GitHub File URL"),e.qZA(),e._UZ(7,"input",4),e.YNc(8,t,3,3,"mat-error",5),e.qZA(),e.YNc(9,x,4,0,"mat-form-field",5),e.YNc(10,R,4,0,"mat-form-field",5),e.qZA()(),e.TgZ(11,"div",6)(12,"button",7),e._uU(13),e.ALo(14,"transloco"),e.qZA(),e.TgZ(15,"button",8),e.NdJ("click",function(){return r.onUpload()}),e._uU(16),e.ALo(17,"transloco"),e.qZA()()),2&n&&(e.xp6(3),e.Q6J("formGroup",r.formGroup),e.xp6(5),e.Q6J("ngIf",null==r.formGroup.controls.url.errors?null:r.formGroup.controls.url.errors.invalidUrl),e.xp6(1),e.Q6J("ngIf",r.formGroup.contains("username")),e.xp6(1),e.Q6J("ngIf",r.formGroup.contains("password")),e.xp6(3),e.Oqu(e.lcZ(14,6,"close")),e.xp6(3),e.hij(" ",e.lcZ(17,8,"upload")," "))},dependencies:[c.ot,c.lW,f.Is,f.ZT,f.uh,f.xY,f.H8,d.lN,d.KE,d.hX,d.TO,g.c,g.Nt,a.UX,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,v.O5,I.Ot]}),b);_=(0,M.gn)([(0,S.c)({checkProperties:!0})],_)},15711:(U,A,i)=>{i.d(A,{H:()=>c,p:()=>f});var M=i(94517);function f(g){return Object.values((0,M.sh)(g)).flatMap(d=>Object.entries(d).map(([a,p])=>{let m=[];return m=p.parameter?p.endpoints.flatMap(v=>{const I=v.match(/{(.*?)}/);if(I){const D=I[1];return[v,...(p.parameter?.[D]||[]).map(T=>v.replace(`{${D}}`,T))]}return v}):p.endpoints,{name:a,endpoints:[...new Set(m)]}}))}function c(g){const d=[],a=new Set;for(const p of g){const m=p.split(".")[0];a.has(m)||(a.add(m),d.push(`${m}.*`)),d.push(p)}return d}}}]);